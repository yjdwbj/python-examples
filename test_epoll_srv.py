#coding=utf-8
#import epoll_srv
import struct
import binascii
import uuid
import unittest

from sockbasic import *

class dumpclass:
    pass

class TestEpollSrv(unittest.TestCase):
    def setUp(self):
        pass
    def tearDown(self):
        pass

#    def gen_uuid(self):
#        u = ''.join([str(uuid.uuid4()).replace('-',''),binascii.hexlify('test')])
#        return ''.join([u,epoll_srv.get_jluuid_crc32(u)])
#
#    def test_gen_ten_jluuid(self):
#        tn = ''
#        n = 0
#        while n < 10:
#            tn = ''.join([tn,self.gen_uuid()])
#            n +=1
#        return tn
#
#    def test_handle_allocate_request(self):
#        return
#        res = dumpclass()
#        res.method=STUN_METHOD_ALLOCATE
#        res.fileno=5
#        res.attrs={}
#        res.attrs[STUN_ATTRIBUTE_UUID] = (STUN_ATTRIBUTE_UUID,24,binascii.unhexlify(self.gen_uuid()))
#        rbuf = epoll_srv.handle_allocate_request(res)
#        self.assertTrue(rbuf)
#
#
#    def test_handle_bind_device(self):
#        res = dumpclass()
#        res.method=STUN_METHOD_CHANNEL_BIND
#        res.fileno=5
#        muuid = self.test_gen_ten_jluuid()
#        res.attrs={}
#        res.attrs[STUN_ATTRIBUTE_MUUID] = (STUN_ATTRIBUTE_MUUID,24*10,binascii.unhexlify(muuid))
#        rbuf = epoll_srv.handle_app_bind_device(res)
#        self.assertTrue(rbuf)
#
#
#    def test_split_uuid(self):
#        muuid = self.test_gen_ten_jluuid()
#        self.assertEqual(len(muuid),(48 * 10))
#        mlist = epoll_srv.split_muuid(muuid)
#        self.assertEqual(len(mlist),10)
#        p = [epoll_srv.check_jluuid(n) for n in mlist]
#        self.assertEqual([x for x in p if x] ,[])
#        [epoll_srv.bind_each_uuid(n,5) for n in mlist]
#        assert epoll_srv.gClass.appbinds[5]
#        print epoll_srv.gClass.appbinds[5]
#
#    def test_check_packet_vaild(self):
#        buf='4a4c00300000000000000000000000030000000080010018373163cda13c4ca9b9e07ac9bb26d58074657374e1494701000d0004000000a0001300087465737464617461a1c7c346'
#        res = epoll_srv.check_packet_vaild(buf)
#        self.assertEqual(res,0)
#        self.assertFalse(res)

    def test_stun_buf_to_list(self):
        buf="00060030353062303139623263326338343662343966306363323531643464323339643430303030303030303132383835343734000800203f0acccc2ebf8f8f955224c55306ed51a7d6040ec154dc92c59db4105761be58"
        mbuf="4a4c0001002c00000a6200000b0700070200002200130010313432393531373132302e353730353068a9a90e4a4c0001002c00000a6200000b0700070200002300130010313432393531373132302e35393231329e4a2de5"
        mbuf="4a4c0001002c00000643000006e800060300005600130010313432393537383933372e343038333153b2fea94a4c0001002c00000643000006e800060300005600130010313432393537383933372e343336313790ccbbfa4a4c0001002c00000643000006e800060300005600130010313432393537383933372e34333632395c59c53e4a4c0001002c00000643000006e800060300005600130010313432393537383933372e34333633354cf4b8544a4c0001002c00000643000006e800060300005600130010313432393537383933372e343336343104d8ea8a4a4c0001002c00000643000006e800060300005600130010313432393537383933372e34333634369abc7f294a4c0001002c00000643000006e800060300005600130010313432393537383933372e34333635311dc3dbcb4a4c0001002c00000643000006e800060300005600130010313432393537383933372e343336353683a74e684a4c0001002c00000643000006e800060300005600130010313432393537383933372e343336363136ee88084a4c0001002c00000643000006e800060300005600130010313432393537383933372e3433363636a88a1dab4a4c0001002c00000643000006e800060300005600130010313432393537383933372e343336373058f289df4a4c0001002c00000643000006e800060300005600130010313432393537383933372e343336373528987d504a4c0001002c00000643000006e800060300005600130010313432393537383933372e3433363830df6a95104a4c0001002c00000643000006e800060300005600130010313432393537383933372e3433363834d80751094a4c0001002c00000643000006e800060300005600130010313432393537383933372e3433363839a6b62db44a4c0001002c00000643000006e800060300005600130010313432393537383933372e34333639335f78f5eb"
        mbuf="4a4c0001002c00001a9300001a7d00070300001d00130010313432393538363132312e3532363632131750734a4c0001002c00001a9300001a7d00070300001d00130010313432393538363132312e3532363632131750734a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e36333638385d3fbec14a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e363935363649ffe0754a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e3639353832d01109e24a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e3639353931500369194a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e363935393829dfd1bd4a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e363936303584eaa8104a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e36393631319a9c5d484a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e363936313773fff87d4a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e363936323228b85f314a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e3639363238c86db62f4a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e36393634370e880c384a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e3639363535f99d5c554a4c0001002c00001a9300001a7d00070300001d00130010313432393538363135362e3639363631d5ddcb8f4a4c0001002c00001a9300001a7d00070200001d00130010313432393538363135362e36393636382d24160c4a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639363735b0b5bc344a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639363831304064e24a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639363836ae24f1414a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639363932b05204194a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639363937c038f0964a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e36393730331755e5f14a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373039f7800cef4a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373134902a41134a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373230bc6ad6c94a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373235cc0022464a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373331d276d71e4a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e36393733364c1242bd4a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373432043e10634a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e36393734377454e4ec4a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e36393735336a2211b44a4c0001002c00001a9300001a7d00070300001e00130010313432393538363135362e3639373538fdf0c83c"
        mbuf="4a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e3031333534b964e7e84a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e3031333631e22340a44a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e30313336370b40e5914a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e3031333733153610c94a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e3031333739f5e3f9d74a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e30313338357bcda9334a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e3031333932fcb20dd14a4c0001002c00001ceb00001d4900060300001400130010313432393538363132352e30313339378cd8f95e4a4c0001002c00001ceb00001d4900060200001400130010313432393538363132352e3031343033de1df5ac4a4c0001002c00001ceb00001d4900060200001400130010313432393538363132352e30313430393ec81cb24a4c0001002c00001ceb00001d4900060200001400130010313432393538363132352e30313431345962514e4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313432306bdd202d4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313432351bb7d4a24a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134333072c6116c4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134333502ace5e34a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313433390b1aa9c84a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313434343aea43b24a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e3031343439445b3f0f4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134353423f172f34a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313435395d400e4e4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134363408dc21304a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e3031343639766d5d8d4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134373411c710714a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134373818715c5a4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e3031343833083b991d4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313438389fe940954a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e30313439331120a85c4a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303134393886f271d44a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e3031353033c12079224a4c0001002c00001ceb00001d4900060300001500130010313432393538363132352e303135303856f2a0aa"
        m1 = "4a4c0001002c00001a9200001a7c00070300001d00130010313432393538363132312e353139323609944a2d4a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e36333731337a8645a74a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639373736330bf6ca4a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e36393738352d9abbbf4a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e36393739344386ba684a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639383031e972b2934a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639383037001117a64a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e36393831331e67e2fe4a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e363938313889b53b764a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639383234ab2e249e4a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639383330b558d1c64a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639383335c53225494a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e36393834318d1e77974a4c0001002c00001a9200001a7c00070300001d00130010313432393538363135362e3639383437647dd2a24a4c0001002c00001a9200001a7c00070200001d00130010313432393538363135362e36393835328c29724b4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e363938353896c77c914a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e36393836332a38f6da4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639383639caed1fc44a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639383735da4062ae4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e36393838302db28aee4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639383836c4d12fdb4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e363938393143ae8b394a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639383937aacd2e0c4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e36393930320aa70bfd4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639393038ea72e2e34a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639393134fadf9f894a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639393139846ee3344a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639393234d1f2cc4a4a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e3639393330cf8439124a4c0001002c00001a9200001a7c00070300001e00130010313432393538363135362e363939333626e79c27"
        mbuf="4a4c000100280000102e00000fe80006030000420013000a313433303232313636360000b4d8e2d54a4c000100280000102e00000fe80006020000400013000a313433303232313636360000058349544a4c000100280000102e00000fe80006030000420013000a313433303232313636360000b4d8e2d54a4c000100280000102e00000fe80006030000420013000a313433303232313636360000b4d8e2d54a4c000100280000102e00000fe80006020000420013000a313433303232313636360000d1bfd9934a4c000100280000102e00000fe80006030000420013000a313433303232313636360000b4d8e2d54a4c000100280000102e00000fe80006030000420013000a313433303232313636360000b4d8e2d54a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006020000440013000a313433303232313636360000768b6e9b4a4c000100280000102e00000fe80006020000430013000a313433303232313636360000561912d04a4c000100280000102e00000fe80006020000430013000a313433303232313636360000561912d04a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006020000410013000a313433303232313636360000822582174a4c000100280000102e00000fe80006020000410013000a313433303232313636360000822582174a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006030000430013000a313433303232313636360000337e29964a4c000100280000102e00000fe80006020000400013000a313433303232313636360000058349544a4c000100280000102e00000fe80006020000420013000a3134333032323136383900003a3ce99d4a4c000100280000102e00000fe80006020000430013000a313433303232313638390000bd9a22de4a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006020000430013000a313433303232313638390000bd9a22de4a4c000100280000102e00000fe80006020000410013000a31343330323231363839000069a6b2194a4c000100280000102e00000fe80006020000410013000a31343330323231363839000069a6b2194a4c000100280000102e00000fe80006020000420013000a3134333032323136383900003a3ce99d4a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006020000440013000a3134333032323136383900009d085e954a4c000100280000102e00000fe80006030000430013000a313433303232313638390000d8fd19984a4c000100280000102e00000fe80006020000430013000a3134333032323137303500004c54dae54a4c000100280000102e00000fe80006030000430013000a3134333032323137303500002933e1a34a4c000100280000102e00000fe80006030000430013000a3134333032323137303500002933e1a34a4c000100280000102e00000fe80006030000430013000a3134333032323137303500002933e1a34a4c000100280000102e00000fe80006020000450013000a313433303232313730350000eb606ded4a4c000100280000102e00000fe80006020000420013000a313433303232313730350000cbf211a64a4c000100280000102e00000fe80006030000430013000a3134333032323137303500002933e1a34a4c000100280000102e00000fe80006030000430013000a3134333032323137303500002933e1a34a4c000100280000102e00000fe80006030000430013000a3134333032323137303500002933e1a34a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006020000430013000a3134333032323137303500004c54dae54a4c000100280000102e00000fe80006020000420013000a313433303232313730350000cbf211a64a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006030000440013000a31343330323231373035000009a19de84a4c000100280000102e00000fe80006020000440013000a3134333032323137303500006cc6a6ae4a4c000100280000102e00000fe80006020000440013000a3134333032323137303500006cc6a6ae4a4c000100280000102e00000fe80006020000440013000a3134333032323137303500006cc6a6ae4a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006020000430013000a313433303232313735370000780efeb94a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006020000450013000a313433303232313735370000df3a49b14a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006020000450013000a313433303232313735370000df3a49b14a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006020000440013000a313433303232313735370000589c82f24a4c000100280000102e00000fe80006020000440013000a313433303232313735370000589c82f24a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b44a4c000100280000102e00000fe80006030000440013000a3134333032323137353700003dfbb9b4"

        mlist = split_requests_buf(mbuf)
        for n in mlist:
            print n
        print "--------------------"
        print "list len %d",len(mlist)
        setlist = set(mlist)
        print "set list len %d",len(setlist)


if __name__ == '__main__':
    unittest.main()
